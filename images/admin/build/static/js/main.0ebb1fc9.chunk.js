(this["webpackJsonpadmin-ciutat_agora"]=this["webpackJsonpadmin-ciutat_agora"]||[]).push([[1],{319:function(t,e,a){"use strict";a.r(e),a.d(e,"appState",(function(){return V}));var n=a(2),o=a(68),r=a.n(o),i=(a(334),a(70)),s=a(304),c=a(302),u=a(297),p=a(301),l=a(50),d=a(0),b=function(){return Object(d.jsxs)(l.WebCardHome,{container:!0,children:[Object(d.jsx)(l.WebCardHome,{titol:"V\xeddeos",descripcio:"Afegir o editar videos",path:"/videos",icona:Object(d.jsx)(s.a,{fontSize:"large"}),xs:12,md:6,lg:4}),Object(d.jsx)(l.WebCardHome,{titol:"Autors",descripcio:"Afegir o editar autors",path:"/autors",icona:Object(d.jsx)(c.a,{fontSize:"large"}),xs:12,md:6,lg:4}),Object(d.jsx)(l.WebCardHome,{titol:"Projectes",descripcio:"Afegir o editar projectes",path:"/projectes",icona:Object(d.jsx)(u.a,{fontSize:"large"}),xs:12,md:6,lg:4}),Object(d.jsx)(l.WebCardHome,{titol:"Temes",descripcio:"Afegir o editar temes",path:"/temes",icona:Object(d.jsx)(p.a,{fontSize:"large"}),xs:12,md:6,lg:4})]})},j=a(300),O=n.lazy((function(){return Promise.all([a.e(0),a.e(6)]).then(a.bind(null,515))})),f=n.lazy((function(){return Promise.all([a.e(0),a.e(5)]).then(a.bind(null,516))})),S=n.lazy((function(){return Promise.all([a.e(0),a.e(4)]).then(a.bind(null,517))})),m=n.lazy((function(){return Promise.all([a.e(0),a.e(7)]).then(a.bind(null,518))})),v=[{path:"",element:Object(d.jsx)(b,{}),index:!0},{path:"videos",element:Object(d.jsx)(m,{}),lazy:!0},{path:"autors",element:Object(d.jsx)(S,{}),lazy:!0},{path:"projectes",element:Object(d.jsx)(f,{}),lazy:!0},{path:"temes",element:Object(d.jsx)(O,{}),lazy:!0}],h=Object(i.observer)((function(){return Object(d.jsxs)(l.WebMenuOption,{container:!0,children:[Object(d.jsx)(l.WebMenuOption,{path:"/",titol:"Inici",icon:Object(d.jsx)(j.a,{})}),Object(d.jsx)(l.WebMenuOption,{path:"/videos",titol:"V\xeddeos",icon:Object(d.jsx)(s.a,{})}),Object(d.jsx)(l.WebMenuOption,{path:"/autors",titol:"Autors",icon:Object(d.jsx)(c.a,{})}),Object(d.jsx)(l.WebMenuOption,{path:"/projectes",titol:"Projectes",icon:Object(d.jsx)(u.a,{})}),Object(d.jsx)(l.WebMenuOption,{path:"/temes",titol:"Temes",icon:Object(d.jsx)(p.a,{})})]})})),g=function(){var t=Object(n.useContext)(V);return Object(d.jsx)(l.WebApp,{titol:"Administraci\xf3 ciutat \xc0gora",appState:t,menu:Object(d.jsx)(h,{}),rutes:v})},w=function(t){t&&t instanceof Function&&a.e(8).then(a.bind(null,514)).then((function(e){var a=e.getCLS,n=e.getFID,o=e.getFCP,r=e.getLCP,i=e.getTTFB;a(t),n(t),o(t),r(t),i(t)}))},A=a(26),E=a(44),_=a(121),x=a(28),P=a(29),M=a(15),N=a(35),C=function(t){Object(x.a)(a,t);var e=Object(P.a)(a);function a(t,n,o){var r,i,s,c;Object(A.a)(this,a);var u=window.location.href,p=u.startsWith(null!==(r="http://localhost")?r:"nothing")?"local":u.startsWith(null!==(i="https://dev.manresa.cat/")?i:"nothing")?"devel":"prod";console.log(p);var l={onError:function(e){var a=e.response.status;a>400&&a<404&&t.userState.logout()},onLoadingChange:function(e){t.loadState.setIsLoading(e)},getToken:function(){return t.userState.token?t.userState.token:""},url:{devel:"https://dev.manresa.cat/api/ciutatagora/adm/v1/",local:"http://localhost:8080/adm/v1/",prod:null!==(s="https://web.manresa.cat/api/ciutatagora/adm/v1/")?s:""},urlDefault:null!==p&&void 0!==p?p:"prod",getUrlApi:n,getId:o};return(c=e.call(this,l)).appState=void 0,c.appState=t,c}return a}(N.ObjApi),F=function(t){Object(x.a)(a,t);var e=Object(P.a)(a);function a(t){Object(A.a)(this,a);return e.call(this,t,(function(){return"temes/"}),(function(t){return t.id}))}return a}(C),y=function(t){Object(x.a)(a,t);var e=Object(P.a)(a);function a(t){var n;return Object(A.a)(this,a),(n=e.call(this,new F(t))).appState=void 0,n.getNewObj=function(){return{id:0,tema:"Nom tema"}},n.onLoad=function(){n.getObjApi().catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)}))},n.onAdd=function(){var t=n.getNewObj();n.startEdit(t,!0),n.setOpenPopup(!0)},n.onEdit=function(t){n.startEdit(t,!1),n.setOpenPopup(!0)},n.onSave=function(){n.validate()?(n.isNew?n.addObjApi().then((function(t){n.setOpenPopup(!1),n.setObjs([].concat(Object(M.a)(n.objs),[t])),n.appState.notiState.showMessage("Guardat correctament","success")})).catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)})):n.updateObjApi().then((function(t){n.setOpenPopup(!1),n.setObjsByObj(t),n.appState.notiState.showMessage("Modificat correctament","success")})).catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)})),n.reset()):n.appState.notiState.showMessage("No es pot guardar, hi ha errors","error")},n.onDel=function(t){n.appState.dialState.newAlert("Esborrar",'Vols esborrar "'+t.tema+'" ?',(function(){return n.delObj(t)}))},n.delObj=function(t){n.startEdit(t),n.delObjApi().then((function(){var e=n.objs.filter((function(e){return e!==t}));n.setObjs(e),n.appState.notiState.showMessage("Esborrat correctament","success")})).catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)}))},n.onClose=function(){n.setOpenPopup(!1),n.reset()},n.validateFunction=function(t,e){e&&"tema"!==e||!t.tema&&n.setError("tema","Aquest camp no pot esta buit")},n.cercarGenerica=function(t,e){return e.text?t.filter((function(t){return t.tema.toLowerCase().includes(e.text.toLowerCase())})):t},n.appState=t,n}return a}(N.ObjState),L=function(t){Object(x.a)(a,t);var e=Object(P.a)(a);function a(t){Object(A.a)(this,a);return e.call(this,t,(function(){return"projectes/"}),(function(t){return t.id}))}return a}(C),k=function(t){Object(x.a)(a,t);var e=Object(P.a)(a);function a(t){var n;return Object(A.a)(this,a),(n=e.call(this,new L(t))).appState=void 0,n.getNewObj=function(){return{id:0,nom:"Nom projecte",resum:"",text:"",web:"",imatge:""}},n.onLoad=function(){n.getObjApi().catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)}))},n.onAdd=function(){var t=n.getNewObj();n.startEdit(t,!0),n.setOpenPopup(!0)},n.onEdit=function(t){n.startEdit(t,!1),n.setOpenPopup(!0)},n.onSave=function(){n.validate()?(n.isNew?n.addObjApi().then((function(t){n.setOpenPopup(!1),n.setObjs([].concat(Object(M.a)(n.objs),[t])),n.appState.notiState.showMessage("Guardat correctament","success")})).catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)})):n.updateObjApi().then((function(t){n.setOpenPopup(!1),n.setObjsByObj(t),n.appState.notiState.showMessage("Modificat correctament","success")})).catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)})),n.reset()):n.appState.notiState.showMessage("No es pot guardar, hi ha errors","error")},n.onDel=function(t){n.appState.dialState.newAlert("Esborrar",'Vols esborrar "'+t.nom+'" ?',(function(){return n.delObj(t)}))},n.delObj=function(t){n.startEdit(t),n.delObjApi().then((function(){var e=n.objs.filter((function(e){return e!==t}));n.setObjs(e),n.appState.notiState.showMessage("Esborrat correctament","success")})).catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)}))},n.onClose=function(){n.setOpenPopup(!1),n.objOrig.imatge!==n.objSel.imatge&&n.appState.delFile(n.objSel.imatge),n.reset()},n.validateFunction=function(t,e){e&&"nom"!==e||!t.nom&&n.setError("nom","Aquest camp no pot esta buit")},n.cercarGenerica=function(t,e){return e.text?t.filter((function(t){return t.nom.toLowerCase().includes(e.text.toLowerCase())})):t},n.appState=t,n}return Object(E.a)(a,[{key:"fileUpload",value:function(t){return this.appState.uploadFile(t,"ciutat_agora/projectes","")}},{key:"onDelImg",value:function(t){this.objOrig.imatge!==t&&this.appState.delFile(t)}}]),a}(N.ObjState),D=function(t){Object(x.a)(a,t);var e=Object(P.a)(a);function a(t){Object(A.a)(this,a);return e.call(this,t,(function(){return"autors/"}),(function(t){return t.id}))}return a}(C),W=function(t){Object(x.a)(a,t);var e=Object(P.a)(a);function a(t){var n;return Object(A.a)(this,a),(n=e.call(this,new D(t))).appState=void 0,n.getNewObj=function(){return{id:0,nom:"Nom autor",resum:"",text:"",web:"",imatge:"",facebook:"",instagram:"",youtube:"",twitter:""}},n.onLoad=function(){n.getObjApi().catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)}))},n.onAdd=function(){var t=n.getNewObj();n.startEdit(t,!0),n.setOpenPopup(!0)},n.onEdit=function(t){n.startEdit(t,!1),n.setOpenPopup(!0)},n.onSave=function(){n.validate()?(n.isNew?n.addObjApi().then((function(t){n.setOpenPopup(!1),n.setObjs([].concat(Object(M.a)(n.objs),[t])),n.appState.notiState.showMessage("Guardat correctament","success")})).catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)})):n.updateObjApi().then((function(t){n.setOpenPopup(!1),n.setObjsByObj(t),n.appState.notiState.showMessage("Modificat correctament","success")})).catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)})),n.reset()):n.appState.notiState.showMessage("No es pot guardar, hi ha errors","error")},n.onDel=function(t){n.appState.dialState.newAlert("Esborrar",'Vols esborrar "'+t.nom+'" ?',(function(){return n.delObj(t)}))},n.delObj=function(t){n.startEdit(t),n.delObjApi().then((function(){var e=n.objs.filter((function(e){return e!==t}));n.setObjs(e),n.appState.notiState.showMessage("Esborrat correctament","success")})).catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)}))},n.onClose=function(){n.setOpenPopup(!1),n.objOrig.imatge!==n.objSel.imatge&&n.appState.delFile(n.objSel.imatge),n.reset()},n.validateFunction=function(t,e){e&&"nom"!==e||!t.nom&&n.setError("nom","Aquest camp no pot esta buit")},n.cercarGenerica=function(t,e){return e.text?t.filter((function(t){return t.nom.toLowerCase().includes(e.text.toLowerCase())})):t},n.appState=t,n}return Object(E.a)(a,[{key:"fileUpload",value:function(t){return this.appState.uploadFile(t,"ciutat_agora/autors","")}},{key:"onDelImg",value:function(t){this.objOrig.imatge!==t&&this.appState.delFile(t)}}]),a}(N.ObjState),z=a(56),T=function(t){Object(x.a)(a,t);var e=Object(P.a)(a);function a(t){Object(A.a)(this,a);return e.call(this,t,(function(){return"videos/"}),(function(t){return t.id}))}return a}(C),B=function(t){Object(x.a)(a,t);var e=Object(P.a)(a);function a(t){var n;return Object(A.a)(this,a),(n=e.call(this)).appState=void 0,n.getNewObj=function(){return{id:0,id_video:n.appState.videosState.objSel.id,id_tema:0}},n.onAdd=function(){n.setOpenPopup(!0)},n.onSelect=function(t){var e=n.objs.filter((function(e){return e.id_tema===t}));if(e.length>0)n.delObj(e[0]);else{var a=n.getNewObj();a.id_tema=t,n.setObjs([].concat(Object(M.a)(n.objs),[a]))}},n.onSave=function(){n.appState.videosState.setObjSel(Object(z.a)(Object(z.a)({},n.appState.videosState.objSel),{},{temes:n.objs})),n.setOpenPopup(!1)},n.delObj=function(t){if(0===t.id){var e=n.objs.filter((function(e){return e!==t}));n.setObjs(e)}else{n.startEdit(t,!1);var a=n.objSel;a.id=-1*a.id,n.setObjsByObj(a)}},n.onClose=function(){n.setOpenPopup(!1),n.reset()},n.validateFunction=function(t,e){},n.getTemes=function(){return n.appState.temesState.objs.map((function(t){return{id:t.id,titol:t.tema}}))},n.getNomTema=function(t){var e=n.appState.temesState.objs.filter((function(e){return e.id===t.id_tema})).pop();return e?e.tema:""},n.appState=t,n}return a}(N.ObjState),I=function(t){Object(x.a)(a,t);var e=Object(P.a)(a);function a(t){var n;return Object(A.a)(this,a),(n=e.call(this)).appState=void 0,n.getNewObj=function(){return{id:0,id_video:n.appState.videosState.objSel.id,id_autor:0}},n.onAdd=function(){n.setOpenPopup(!0)},n.onSelect=function(t){var e=n.objs.filter((function(e){return e.id_autor===t}));if(e.length>0)n.delObj(e[0]);else{var a=n.getNewObj();a.id_autor=t,n.setObjs([].concat(Object(M.a)(n.objs),[a]))}},n.onSave=function(){n.appState.videosState.setObjSel(Object(z.a)(Object(z.a)({},n.appState.videosState.objSel),{},{autors:n.objs})),n.setOpenPopup(!1)},n.delObj=function(t){if(0===t.id){var e=n.objs.filter((function(e){return e!==t}));n.setObjs(e)}else{n.startEdit(t,!1);var a=n.objSel;a.id=-1*a.id,n.setObjsByObj(a)}},n.onClose=function(){n.setOpenPopup(!1),n.reset()},n.validateFunction=function(t,e){},n.getAutors=function(){return n.appState.autorsState.objs.map((function(t){return{id:t.id,titol:t.nom}}))},n.getNom=function(t){var e=n.appState.autorsState.objs.filter((function(e){return e.id===t.id_autor})).pop();return e?e.nom:""},n.appState=t,n}return a}(N.ObjState),G=function(t){Object(x.a)(a,t);var e=Object(P.a)(a);function a(t){var n;return Object(A.a)(this,a),(n=e.call(this)).appState=void 0,n.getNewObj=function(){return{id:0,id_video:n.appState.videosState.objSel.id,nom_document:"",url_document:""}},n.onAdd=function(){var t=n.getNewObj();n.startEdit(t,!0),n.setOpenPopup(!0)},n.onEdit=function(t){n.startEdit(t,!1),n.setOpenPopup(!0)},n.onSave=function(){var t=n.objSel;n.validate()?(n.isNew?n.setObjs([].concat(Object(M.a)(n.objs),[t])):(0===t.id&&n.objOrig.url_document!==t.url_document&&n.appState.delFile(n.objOrig.url_document),n.setObjsByObj(t)),n.appState.videosState.setObjSel(Object(z.a)(Object(z.a)({},n.appState.videosState.objSel),{},{documents:n.objs})),n.setOpenPopup(!1),n.reset()):n.appState.notiState.showMessage("No s'ha pogut guardar, hi ha errors","error")},n.onDel=function(t){n.appState.dialState.newAlert("Esborrar",'Vols esborrar aquest "'+n.getNom(t)+'"?',(function(){return n.delObj(t)}))},n.delObj=function(t){if(0===t.id){var e=n.objs.filter((function(e){return e!==t}));n.setObjs(e),""!==t.url_document&&n.appState.delFile(t.url_document)}else{n.startEdit(t,!1);var a=n.objSel;a.id=-1*a.id,n.setObjsByObj(a)}n.appState.videosState.setObjSel(Object(z.a)(Object(z.a)({},n.appState.videosState.objSel),{},{documents:n.objs}))},n.onClose=function(){n.setOpenPopup(!1),n.objOrig.url_document!==n.objSel.url_document&&n.appState.delFile(n.objSel.url_document),n.reset()},n.validateFunction=function(t,e){},n.getNom=function(t){return t.nom_document},n.appState=t,n}return Object(E.a)(a,[{key:"fileUpload",value:function(t){return this.appState.uploadFile(t,"ciutat_agora/documents","")}},{key:"onDelImg",value:function(t,e){this.objOrig.url_document!==e&&this.appState.delFile(e)}}]),a}(N.ObjState),q=function(t){Object(x.a)(a,t);var e=Object(P.a)(a);function a(t){var n;return Object(A.a)(this,a),(n=e.call(this,new T(t))).appState=void 0,n.temes=void 0,n.autors=void 0,n.documents=void 0,n.getNewObj=function(){return{id:0,nom:"Nom v\xeddeo",resum:"",text:"",imatge_h:"",imatge_v:"",url_video:"",destacat:!1,ordre:1,id_projecte:-1,url_podcast:"",url_subtitols:"",url_versio_original:"",url_versio_eng:"",durada:"",temes:[],autors:[],documents:[],data_video:(new Date).toISOString().split("T")[0]}},n.onLoad=function(){n.appState.projectesState.onLoad(),n.appState.temesState.onLoad(),n.appState.autorsState.onLoad(),n.getObjApi().catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)}))},n.onChangeDate=function(t){t.target.value&&null!=t.target.value&&(t.target.value=n.appState.convertDateToUTC(t.target.value)),n.onChange(t)},n.onAdd=function(){var t=n.getNewObj();n.startEdit(t,!0),n.temes.setObjs(t.temes),n.autors.setObjs(t.autors),n.documents.setObjs(t.documents),n.setOpenPopup(!0)},n.onEdit=function(t){n.startEdit(t,!1),n.temes.setObjs(t.temes),n.autors.setObjs(t.autors),n.documents.setObjs(t.documents),n.setOpenPopup(!0)},n.onSave=function(){n.setObjSel(Object(z.a)(Object(z.a)({},n.objSel),{},{temes:n.temes.objs,autors:n.autors.objs,documents:n.documents.objs})),n.validate()?(n.isNew?n.addObjApi().then((function(t){n.setOpenPopup(!1),n.onLoad(),n.appState.notiState.showMessage("Guardat correctament","success")})).catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)})):n.updateObjApi().then((function(t){n.setOpenPopup(!1),n.onLoad(),n.appState.notiState.showMessage("Modificat correctament","success")})).catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)})),n.reset()):n.appState.notiState.showMessage("No es pot guardar, hi ha errors","error")},n.onDel=function(t){n.appState.dialState.newAlert("Esborrar",'Vols esborrar "'+t.nom+'" ?',(function(){return n.delObj(t)}))},n.delObj=function(t){n.startEdit(t),n.delObjApi().then((function(){n.onLoad(),n.appState.notiState.showMessage("Esborrat correctament","success")})).catch((function(t){var e;null===(e=n.appState)||void 0===e||e.onErrorApi(t)}))},n.onClose=function(){n.setOpenPopup(!1),n.objOrig.imatge_v!==n.objSel.imatge_v&&n.appState.delFile(n.objSel.imatge_v),n.objOrig.imatge_h!==n.objSel.imatge_h&&n.appState.delFile(n.objSel.imatge_h),n.objSel.documents.map((function(t,e){return 0===t.id&&n.appState.delFile(t.url_document),"ok"})),n.reset()},n.validateFunction=function(t,e){e&&"nom"!==e||!t.nom&&n.setError("nom","Aquest camp no pot esta buit"),e&&"data_video"!==e||!t.data_video&&n.setError("data_video","Aquest camp no pot esta buit")},n.cercarGenerica=function(t,e){return e.text?t.filter((function(t){return t.nom.toLowerCase().includes(e.text.toLowerCase())})):t},n.getProjectes=function(){return n.appState.projectesState.objs.map((function(t){return{id:t.id,titol:t.nom}}))},n.appState=t,n.temes=new B(t),n.autors=new I(t),n.documents=new G(t),n}return Object(E.a)(a,[{key:"fileUpload",value:function(t){return this.appState.uploadFile(t,"ciutat_agora/videos","")}},{key:"onDelImg",value:function(t,e){("imatge_h"===t?this.objOrig.imatge_h:"imatge_v"===t?this.objOrig.imatge_v:e)!==e&&this.appState.delFile(e)}}]),a}(N.ObjState),U=function(t){Object(x.a)(a,t);var e=Object(P.a)(a);function a(){var t,n;return Object(A.a)(this,a),(n=e.call(this,11)).temesState=new y(Object(_.a)(n)),n.projectesState=new k(Object(_.a)(n)),n.autorsState=new W(Object(_.a)(n)),n.videosState=new q(Object(_.a)(n)),n.urlMedia=void 0,n.urlApiMedia=void 0,n.convertDateToUTC=function(t){return new Date(t).toLocaleString("sv-SE").split(" ")[0]},n.delFile=function(t){var e=new N.WebApi,a=n.urlApiMedia,o={obj:{action:"delete",nom:t}},r={Authorization:"Bearer "+n.userState.token};return e.putRequest(a,o,r).then((function(t){})).catch((function(t){n.onErrorApi(t)}))},n.urlMedia=null!==(t="https://web.manresa.cat/media/")?t:"",n.urlApiMedia="https://web.manresa.cat/api/media/adm/v1/media",n}return Object(E.a)(a,[{key:"uploadFile",value:function(t,e,a){var n=this,o=new N.WebApi,r=this.urlApiMedia,i=new FormData;i.append("file",t[0]),i.append("carpeta",e),a&&""!==a&&i.append("mides",a);var s={"Content-Type":"multipart/form-data",Authorization:"Bearer "+this.userState.token};return o.postRequest(r,i,s).then((function(t){return t.dades.file})).catch((function(t){n.onErrorApi(t)}))}}]),a}(l.AppStateGeneric),V=Object(n.createContext)(new U);r.a.render(Object(d.jsx)(V.Provider,{value:new U,children:Object(d.jsx)(g,{})}),document.getElementById("root")),w()},334:function(t,e,a){}},[[319,2,3]]]);